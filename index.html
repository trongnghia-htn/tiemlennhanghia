<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Tiệm Len Nhà Nghĩa - Đồ len Handmade</title>
    <meta name="description" content="Tiệm Len Nhà Nghĩa chuyên đồ len handmade, phụ kiện len, quà tặng len dễ thương, nhận làm theo yêu cầu, giá cả hợp lý, chất lượng uy tín.">
    <meta name="keywords" content="tiệm len, len handmade, phụ kiện len, quà tặng len, Tiệm Len Nhà Nghĩa, đồ len, handmade, móc len, quà tặng, Nghĩa bán len">
    <meta name="author" content="Tiệm Len Nhà Nghĩa">
    <meta property="og:title" content="Tiệm Len Nhà Nghĩa - Đồ len Handmade">
    <meta property="og:description" content="Tiệm Len Nhà Nghĩa chuyên đồ len handmade, phụ kiện len, quà tặng len dễ thương, nhận làm theo yêu cầu.">
    <meta property="og:image" content="https://trongnghia-htn.github.io/tiemlennhanghia/photos/thumnail.png">
    <meta property="og:url" content="https://trongnghia-htn.github.io/tiemlennhanghia/">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Tiệm Len Nhà Nghĩa">
    <link rel="preload" as="image" href="photos/intro.png">
    <link rel="icon" type="image/webp" href="photos/logo.webp">
    <meta name="google-site-verification" content="WgGeR9djbx2N4OKYuFHXf3Wxcw9Tg5i7oXHJkxgwXKE" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Store",
      "name": "Tiệm Len Nhà Nghĩa",
      "image": "https://trongnghia-htn.github.io/tiemlennhanghia/photos/logo.png",
      "url": "https://trongnghia-htn.github.io/tiemlennhanghia/",
      "description": "Tiệm Len Nhà Nghĩa chuyên cung cấp sản phẩm, phụ kiện, móc khóa, đồ trang trí bằng len sợi được làm thủ công an toàn, chất lượng cao, nhận vận chuyển toàn quốc."
    }
    </script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "Tiệm Len Nhà Nghĩa",
      "url": "https://trongnghia-htn.github.io/tiemlennhanghia/"
    }
    </script>
    <style>
        html {
            touch-action: manipulation;
        }
        * {
            -webkit-tap-highlight-color: transparent;
        }
        body {
            background: linear-gradient(360deg, #e2c9ec 0%, #f9e6b3 50%, #c9eaf3 100%);
            min-height: 100vh;
            margin: 0;
            display: flex;
            flex-direction: column;
        }
        .row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }
        .row img {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }
        .row a:hover img {
            transform: scale(1.08);
        }
        .row h1 {
            margin: 0;
            font-size: 2.5em;
            color: #4250d0c4;
            font-family: system-ui, sans-serif;
            background: linear-gradient(90deg, #e91e63, #2196f3, #ffeb3b);
            background-size: 400% auto;
            background-clip: text;
            -webkit-background-clip: text;
            color: transparent;
            -webkit-text-fill-color: transparent;
            animation: gradientText 6s linear infinite alternate;
        }
        @keyframes gradientText {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }
        .contact {
            font-family: system-ui, sans-serif;
            font-size: 0.85em;
            color: #333;
            opacity: 0.7;
            margin: 1px 0;
            display: inline-block;
        }
        .hello {
            text-align: center;
            font-size: 1em;
            color: #0a3c21;
            margin-top: 2px;
            font-family: system-ui, sans-serif;
            opacity: 0.8;
            font-weight: bold;
        }
        .menu {
            position: fixed;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            background: linear-gradient(90deg,#9299d6c4, #4ac8df, #2196f3);
            padding: 8px 20px;
            border-radius: 32px;
            bottom: 24px;
            left: 45%;
            width: auto;
            z-index: 100;
            font-family: system-ui, sans-serif;
            transition: transform 0.3s, opacity 0.3s;
        }
        .menu a {
            position: relative;
            text-decoration: none;
            color: #4250d0c4;
            font-weight: bold;
            margin: 0 8px;
            transition: color 0.1s;
            -webkit-tap-highlight-color: transparent;
        }
        .menu a i {
            font-size: 1.7em;
            transition: color 0.1s;
        }
        .menu a.active,
        .menu a.active i {
            color: #fafafa !important;
        }
        .menu.hide {
            transform: translateY(100px);
            opacity: 0;
            pointer-events: none;
        }
        .menu.show {
            transform: translateY(0);
            opacity: 1;
            pointer-events: auto;
        }
        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 24px;
            padding: 24px 5vw;
            justify-items: center;
        }
        .gallery img {
            max-width: 200px;
            width: 100%;
            aspect-ratio: 1 / 1;
            object-fit: cover;
            border-radius: 20px;
            transition: transform 0.1s;
            cursor: pointer;
        }
        .gallery img:hover {
            transform: scale(1.02);
        }
        .gallery figure {
            margin: 0;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .gallery figcaption {
            position: absolute;
            left: 50%;
            bottom: 2px;
            transform: translateX(-50%);
            background: rgba(56, 34, 34, 0.7);
            color: #fff;
            font-size: 0.9em;
            padding: 4px 20px;
            border-radius: 15px;
            opacity: 0.8;
            text-align: center;
            max-width: 90%;
            pointer-events: none;
        }
        .dynamic-popup {
            position: fixed;
            left: 50%;
            bottom: 90px;
            transform: translateX(-50%);
            z-index: 9999;
            display: block;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.18s;
        }
        .dynamic-popup.active {
            opacity: 1;
            pointer-events: auto;
            transform: translateX(-50%);
        }
        .dynamic-content {
            background: #fff;
            border-radius: 18px;
            padding: 10px 16px;
            min-width: unset;
            max-width: 95vw;
            text-align: left;
            font-family: system-ui, sans-serif;
            font-size: 1.05em;
            font-weight: 500;
            transform: scale(1);
            display: inline-block;
            box-sizing: border-box;
        }
        
        #search-content {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #searchInput {
            width: 100%;
            padding: 8px 12px;
            border-radius: 12px;
            border: 1px solid #ccc;
            margin-bottom: 12px;
            font-size: 1em;
            box-sizing: border-box;
            display: block;
        }
       
        #zoom-view {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 16px;
            margin: 24px 0;
        }
        .zoom-img {
            width: 100%;
            max-width: 300px;
            max-height: 50vh;
            border-radius: 24px;
            margin-right: 12px;
            background: #fff;
            padding: 12px;
            object-fit: contain;
            display: block;
        }
        .zoom-info {
            position: relative;
            background: #fff;
            border-radius: 24px;
            box-shadow: 0 8px 32px #0002;
            padding: 22px 28px;
            min-width: 220px;
            max-width: 340px;
            font-family: system-ui, sans-serif;
            color: #333;
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-left: 8px;
            word-break: break-word;
        }
        .zoom-title {
            font-size: 1.35em;
            font-weight: bold;
            margin-bottom: 6px;
            text-align: left;
        }
        .zoom-price {
            color: #e53935;
            font-size: 1.18em;
            font-weight: bold;
            margin-bottom: 4px;
            text-align: left;
        }
        .zoom-size-color {
            font-size: 1em;
            color: #444;
            margin-bottom: 4px;
            line-height: 1.5;
        }
        .zoom-intro {
            font-style:italic;
            font-weight: normal;
            font-size: 0.8em;
            color: #222;
            margin-top: 2px;
            line-height: 1.6;
            text-align: left;
        }
        .zoom-close {
            position: absolute;
            top: 12px;
            right: 18px;
            font-size: 2em;
            cursor: pointer;
            color: #e53935;
            background: none;
            border: none;
            outline: none;
            z-index: 10;
            transition: color 0.2s;
        }
        .footer-end {
            text-align: center;
            font-size: 0.95em;
            color: #888;
            opacity: 0.7;
            margin-bottom: 24px;
            margin-top: auto;
            padding: 0 4vw;
        }
        .hidden-body > :not(#intro-overlay) {
        display: none !important;
        }
        #intro-overlay {
            position: fixed;
            z-index: 99999;
            inset: 0;
            background: linear-gradient(360deg, #e2c9ec 0%, #f9e6b3 50%, #c9eaf3 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 0.4s;
        }
        #intro-overlay.hide {
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
        }
       
        #intro-overlay h1,
        #intro-overlay img {
            animation: introScaleFade 1.5s cubic-bezier(.4,1.6,.6,1) forwards;
        }
        .intro-sub {
            font-size: 1em;
            font-weight: bold;
            color: #634141;
            font-family: system-ui,sans-serif;
            text-align: center;
            opacity: 0.8;
            margin-top: 2px;
        }
        #intro-overlay h1 {
            margin-bottom: 0.1em;
            animation: introScaleFade 1s cubic-bezier(.4,1.6,.6,1) forwards;
        }
        @keyframes introScaleFade {
            0% {
                opacity: 0.2;
                transform: scale(0.7);
            }
            60% {
                opacity: 1;
                transform: scale(1.08);
            
            }
            100% {
                opacity: 0.7;
                transform: scale(1);
            }
        }
        /* MOBILE OPTIMIZATION */
        @media (max-width: 600px) and (hover: none) and (pointer: coarse) {
            
            body {
                min-height: 100vh;
                font-size: 16px;
                padding: 0;
            }
            .row {
                flex-direction: row;
                align-items: center;
                justify-content: center;
                gap: 10px;
                padding: 8px 0;
            }
            .row img {
                width: 70px;
                height: 70px;
            }
            .row h1 {
                font-size: 1.5em;
                text-align: left;
                margin-left: 0;
            }
            .contact {
                font-size: 0.75em;
                text-align: left;
            }
            
            .marquee-wrap {
                position: relative;
                margin-top: 0;
                padding-top: 44px;
            }
            .menu {
                position: absolute !important;
                top: 0 !important;
                bottom: auto !important;
                right: 12px !important;
                left: auto !important;
                margin: 0 !important;
                z-index: 1002 !important;
                background: linear-gradient(90deg,#9299d6c4, #4ac8df, #2196f3);
                border-radius: 24px !important;
                padding: 6px 10px !important;
                width: auto !important;
                display: flex;
                align-items: center;
                gap: 8px;
                
            }
            
           
            .gallery {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
                padding: 8px 2vw;
            }
            .gallery img {
                max-width: 100%;
                border-radius: 12px;
            }
            .gallery figcaption {
                font-size: 0.8em;
                padding: 2px 8px;
                border-radius: 8px;
            }
            .zoom-img {
                max-width: 70vw;
                max-height: 35vh;
                margin-right: 0;
                border-radius: 14px;
                padding: 6px;
                width: 100%;
                height: auto;
            }
            .zoom-info {
                width: 260px;
                max-width: 90vw;
                min-width: 0;
                margin-top: 12px;
                margin-left: 12px;
                padding: 10px 12px;
                border-radius: 12px;
                font-size: 0.95em;
                gap: 4px;
            }
            .zoom-title {
                font-size: 1.1em;
            }
            .zoom-price {
                font-size: 1em;
            }
            .zoom-close {
                font-size: 1.3em;
                top: 4px;
                right: 8px;
            }
            #zoom-view {
                margin: 12px 0;
                flex-direction: column;
                align-items: center;
            }
            .dynamic-content {
                padding: 10px 6px;
                min-width: 0;
                max-width: 98vw;
                font-size: 1em;
            }
            .footer-end {
                font-size: 0.8em;
                padding: 0 4vw;
                margin-bottom: 12px;
            }
            .row img,
            .gallery img,
            .row a:hover img,
            .gallery img:hover,
            .gallery figure.filter-anim,
            #zoom-view,
            .zoom-img,
            .zoom-close,
            .hello {
                transition: none !important;
                animation: none !important;
            }
            
            .gallery figure,
            #zoom-view {
                animation: none !important;
            }
            
            .menu,
            .menu.show,
            .menu.hide {
                transform: translateY(0) !important;
                opacity: 1 !important;
                pointer-events: auto !important;
            }
            .gallery img,
            .gallery figure {
                transition: none !important;
                animation: none !important;
                outline: none !important;
                box-shadow: none !important;
                filter: none !important;
                background: none !important;
                -webkit-tap-highlight-color: transparent !important;
            }
            .gallery img:active,
            .gallery figure:active,
            .gallery img:hover,
            .gallery figure:hover {
                transition: none !important;
                animation: none !important;
                outline: none !important;
                box-shadow: none !important;
                filter: none !important;
                background: none !important;
                -webkit-tap-highlight-color: transparent !important;
                transform: none !important;
            }
           
           
            #search-popup.dynamic-popup {
                position: absolute !important;
                top: -5px !important;
                left: 30px !important;
                right: auto !important;
                bottom: auto !important;
                transform: none !important;
                width: calc(80vw - 100px) !important;
                z-index: 1002 !important;
                margin: 0 !important;
                display: flex !important;
                align-items: center;
                height: 48px;
                background: none !important;
                box-shadow: none !important;
            }
            #search-popup .dynamic-content {
                background: transparent !important;
                border-radius: 0 !important;
                padding: 0 !important;
                width: 100%;
                display: flex;
                align-items: center;
            }
            #searchInput {
                border-radius: 10px !important;
                font-size: 1.05em !important;
                padding: 8px 14px !important;
                height: 36px !important;
                max-width: 100% !important;
                margin: 0 !important;
            }
            #search-popup:not(.active) {
                display: none !important;
            }
            #search-popup.dynamic-popup,
            #search-popup .dynamic-content {
                    border-radius: 18px !important;
            }
            
            *, *::before, *::after {
                box-shadow: none !important;
            }
            .dynamic-popup {
                transition: none !important;
            }
                    
        }
        
            #gallery-pagination {
                display: flex;
                justify-content: center;
                align-items: center;
                gap: 6px;
                margin: 16px 0;
                background: none;
                font-family: system-ui, sans-serif;
                font-weight: 500;
            }

            .pagination-btn {
                background: linear-gradient(145deg, #6a5a8c, #9e8aac);
                border: none;
                color: #fdfaff;
                font-size: 1.5em;
                border-radius: 50%;
                width: 48px;
                height: 48px;
                min-width: 48px;
                min-height: 48px;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 0;
                border: 2px solid #bca6d5;
            }

            .pagination-btn:disabled {
                opacity: 1; 
            }
            .pagination-btn:disabled .arrow {
                opacity: 0.3;
            }

            .pagination-center {
                display: flex;
                align-items: center;
                background: linear-gradient(90deg, #6a5a8c 70%, #fdfaff 100%);
                border-radius: 24px;
                padding: 0 18px;
                height: 48px;
                min-height: 48px;
                gap: 4px;
                border: 1px solid #bca6d5;
            }

            .pagination-current {
                background: linear-gradient(220deg, #e7c873 60%, #fffbe9 100%);
                color: #4a3f6d;
                border-radius: 10px;
                padding: 2px 6px;
                font-size: 1.05em;
                margin: 0 2px;
                border: 1px solid #d5b87a;
                min-width: 22px;
                text-align: center;
                display: inline-block;
                height: 28px;
                line-height: 28px;
                font-weight: bold;
            }

            #gallery-pagination span {
                color: #fdfaff;
                font-size: 1em;
            }
    </style>
</head>
<body class="hidden-body">
    <div id="intro-overlay">
        <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:380px;">
                <img src="photos/intro.png" alt="Tiệm Len Nhà Nghĩa" style="width:440px;max-width:98vw;background:transparent;display:block;margin:auto;box-shadow:none;border-radius:0;">
        </div>
    </div>
    <div class="row">
        <div onclick="location.reload()" style="cursor:pointer;display:inline-block;">
            <img src="photos/logo.webp" alt="LOGO">
        </div>
        <div>
            <h1>Tiệm Len Nhà Nghĩa</h1>
            <div>
              <p class="contact">Giá cả Ô CÊ 😘</p><br>
                <p class="contact">Đa dạng mẫu mã 🌻</p><br>
                <p class="contact">Có nhận làm theo yêu cầu 🎇</p> <br>
            </div>
        </div>
    </div>
    <div class="marquee-wrap">
        <nav class="menu">
            <a href="#tiemkim" title="Tìm kiếm">
                <svg width="1.7em" height="1.7em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round" style="vertical-align:middle;">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
            </a>
            <a href="#lienhe" title="Liên hệ">
                <svg width="1.7em" height="1.7em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round" style="vertical-align:middle;">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                </svg>
            </a>
        </nav>
        <div id="search-popup" class="dynamic-popup">
        <div class="dynamic-content" id="search-content">
            <input type="search" id="searchInput" placeholder="Bạn cần gì nè..." inputmode="search" enterkeyhint="search" autocomplete="off">
            <div id="searchResult" style="font-size:0.95em;color:#333;text-align:left;"></div>
        </div>
    </div>
        <hr>
        <p class="hello">Quẹo lựa thoải mái ạ!</p>
    </div>
    <div id="zoom-view" style="display:none;">
        <img class="zoom-img" src="" alt="">
        <div class="zoom-info">
            <button class="zoom-close" title="Đóng">&times;</button>
            <h2 class="zoom-title"></h2>
            <div class="zoom-price"></div>
            <div class="zoom-size-color"></div>
            <p class="zoom-intro"></p>
        </div>
    </div>
    
    <div class="gallery"></div>
    <!-- Đặt popup tìm kiếm trước gallery -->
    
    <div id="gallery-message" style="text-align:center;margin:16px 0 0 0;"></div>
            <!-- Modal thông báo hướng dẫn -->
                    <div id="modal-huongdan" style="display:none;position:fixed;z-index:20000;left:0;top:0;width:100vw;height:100vh;background:rgba(0,0,0,0.45);justify-content:center;align-items:center;">
                        <div style="position:relative;display:inline-block;">
                            <img src="photos/huongdan.webp" alt="Hướng dẫn" style="max-width:90vw;max-height:85vh;border-radius:16px;box-shadow:0 4px 32px #000b;display:block;"/>
                            <button id="close-huongdan" style="position:absolute;top:8px;right:12px;font-size:2.2em;background:none;border:none;color:#a8520c;cursor:pointer;z-index:2;line-height:1;">&times;</button>
                        </div>
                    </div>
    <div id="dynamic-popup" class="dynamic-popup">
        <div class="dynamic-content" id="dynamic-content">
            <div style="text-align:center;">
                <strong>Liên Hệ</strong>
            </div>
            <hr style="margin: 20px 10;">
            <div style="font-size:0.8em;opacity:0.8;">
                ZALO: <a href="https://zalo.me/0385105764" target="_blank">Trọng Nghĩa</a>
                <br>
                FACEBOOK: <a href="https://www.facebook.com/share/1F2p2B7MUk/" target="_blank">Tiệm Len Nhà Nghĩa</a>
                <br>
                TIKTOK: <a href="https://www.tiktok.com/@tiemlennhanghia" target="_blank">@tiemlennhanghia</a>
                <br>
                INSTAGRAM: <a href="https://www.instagram.com/tiemlennhanghia/" target="_blank">@tiemlennhanghia</a>
            </div>
        </div>
    </div>
    <div id="product-popup" class="dynamic-popup" style="z-index:10000;">
        <div class="dynamic-content" id="product-content" style="position:relative;">
            <span id="close-product-popup" style="position:absolute;top:12px;right:18px;font-size:1.5em;cursor:pointer;color:#e53935;">&times;</span>
            <div id="product-info"></div>
        </div>
    </div>
    <div class="footer-end">
        © 2025 Nghĩa.<br>
        Thiết kế và phát triển bởi TIỆM LEN NHÀ NGHĨA</a> <br>
    </div>
    <script src="products.js"></script>
    <script>
    
    function loadGalleryImages(callback) {
        const cacheKey = 'galleryImagesCache_v1';
        const cache = localStorage.getItem(cacheKey);
        if (cache) {
            try {
                window.galleryImages = JSON.parse(cache);
                callback();
                return;
            } catch (e) {
                localStorage.removeItem(cacheKey);
            }
        }
        
        const script = document.createElement('script');
        script.src = 'galleryImages.js';
        script.onload = function() {
            if (window.galleryImages) {
                try {
                    localStorage.setItem(cacheKey, JSON.stringify(window.galleryImages));
                } catch (e) {}
            }
            callback();
        };
        document.head.appendChild(script);
    }
    </script>
    <script>
        const gallery = document.querySelector('.gallery');
        const searchInput = document.getElementById('searchInput');
        const zoomView = document.getElementById('zoom-view');
        let PAGE_SIZE = window.innerWidth <= 600 ? 10 : 15;
        let currentPage = 1;
        let searchTimeout;
        let isSearching = false;
        let searchResults = [];
        let searchPage = 1;

        
        function renderGalleryPage(page) {
            gallery.classList.add('loading');
            gallery.style.display = 'none';
            requestAnimationFrame(() => {
                const start = (page - 1) * PAGE_SIZE;
                const end = Math.min(start + PAGE_SIZE, galleryImages.length);
                const items = end - start;
                
                const fragment = document.createDocumentFragment();
                for (let i = 0; i < items; i++) {
                    const imgData = galleryImages[start + i];
                    const figure = document.createElement('figure');
                    const img = document.createElement('img');
                    img.width = 200;
                    img.height = 200;
                    img.loading = "lazy";
                    img.style.display = "block";
                    img.src = imgData.src;
                    img.alt = imgData.code;
                    figure.appendChild(img);
                    const caption = document.createElement('figcaption');
                    caption.textContent = imgData.code;
                    figure.appendChild(caption);
                    figure.onclick = function() {
                        showZoomView(imgData.code, imgData.src);
                    };
                    fragment.appendChild(figure);
                }
                gallery.innerHTML = '';
                gallery.appendChild(fragment);
                renderPagination();
                gallery.classList.remove('loading');
                gallery.style.display = '';
            });
        }

        
        function renderPagination() {
            let pagination = document.getElementById('gallery-pagination');
            if (!pagination) {
                pagination = document.createElement('div');
                pagination.id = 'gallery-pagination';
                gallery.parentNode.insertBefore(pagination, document.getElementById('gallery-message'));
            }
            const totalPages = Math.ceil(galleryImages.length / PAGE_SIZE);
            let html = `
                <button class="pagination-btn" id="prev-page" ${currentPage === 1 ? 'disabled' : ''} title="Trang trước"><span class="arrow">&#8592;</span></button>
                <div class="pagination-center">
                    <span>Trang</span>
                    <input type="text" inputmode="numeric" pattern="[0-9]*" min="1" max="${totalPages}" value="${currentPage}" class="pagination-current" id="page-input" style="width:44px;text-align:center;">
                    <span>/ ${totalPages}</span>
                </div>
                <button class="pagination-btn" id="next-page" ${currentPage === totalPages ? 'disabled' : ''} title="Trang sau"><span class="arrow">&#8594;</span></button>
            `;
            pagination.innerHTML = html;

            document.getElementById('prev-page').onclick = () => {
                if (currentPage > 1) {
                    currentPage--;
                    renderGalleryPage(currentPage);
                }
            };
            document.getElementById('next-page').onclick = () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    renderGalleryPage(currentPage);
                }
            };

            const pageInput = document.getElementById('page-input');
            let lastPageValue = currentPage;

            pageInput.onfocus = function() {
                lastPageValue = this.value;
                this.value = '';
            };
            pageInput.onblur = function() {
                let val = parseInt(this.value, 10);
                if (isNaN(val)) {
                    this.value = lastPageValue;
                    return;
                }
                if (val < 1) val = 1;
                if (val > totalPages) val = totalPages;
                
                currentPage = val;
                renderGalleryPage(currentPage);
            };
            pageInput.onkeydown = function(e) {
                if (e.key === 'Enter') {
                    this.blur();
                }
            };
        }

        
        function renderSearchPage(page) {
            gallery.classList.add('loading');
            gallery.style.display = 'none';
            requestAnimationFrame(() => {
                const start = (page - 1) * PAGE_SIZE;
                const end = Math.min(start + PAGE_SIZE, searchResults.length);
                const items = end - start;
                
                const fragment = document.createDocumentFragment();
                for (let i = 0; i < items; i++) {
                    const imgData = searchResults[start + i];
                    const figure = document.createElement('figure');
                    const img = document.createElement('img');
                    img.width = 200;
                    img.height = 200;
                    img.loading = "lazy";
                    img.style.display = "block";
                    img.src = imgData.src;
                    img.alt = imgData.code;
                    figure.appendChild(img);
                    const caption = document.createElement('figcaption');
                    caption.textContent = imgData.code;
                    figure.appendChild(caption);
                    figure.onclick = function() {
                        showZoomView(imgData.code, imgData.src);
                    };
                    fragment.appendChild(figure);
                }
                gallery.innerHTML = '';
                gallery.appendChild(fragment);
                renderSearchPagination();
                gallery.classList.remove('loading');
                gallery.style.display = '';
            });
        }

        
        function renderSearchPagination() {
            let pagination = document.getElementById('gallery-pagination');
            if (!pagination) {
                pagination = document.createElement('div');
                pagination.id = 'gallery-pagination';
                gallery.parentNode.insertBefore(pagination, document.getElementById('gallery-message'));
            }
            const totalPages = Math.ceil(searchResults.length / PAGE_SIZE) || 1;
            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }
            let html = `
                <button class="pagination-btn" id="prev-search-page" ${searchPage === 1 ? 'disabled' : ''} title="Trang trước"><span class="arrow">&#8592;</span></button>
                <div class="pagination-center">
                    <span>Trang</span>
                    <input type="text" inputmode="numeric" pattern="[0-9]*" min="1" max="${totalPages}" value="${searchPage}" class="pagination-current" id="search-page-input" style="width:44px;text-align:center;">
                    <span>/ ${totalPages}</span>
                </div>
                <button class="pagination-btn" id="next-search-page" ${searchPage === totalPages ? 'disabled' : ''} title="Trang sau"><span class="arrow">&#8594;</span></button>
            `;
            pagination.innerHTML = html;

            document.getElementById('prev-search-page').onclick = () => {
                if (searchPage > 1) {
                    searchPage--;
                    renderSearchPage(searchPage);
                }
            };
            document.getElementById('next-search-page').onclick = () => {
                if (searchPage < totalPages) {
                    searchPage++;
                    renderSearchPage(searchPage);
                }
            };

            const searchPageInput = document.getElementById('search-page-input');
            let lastSearchPageValue = searchPage;

            searchPageInput.onfocus = function() {
                lastSearchPageValue = this.value;
                this.value = '';
            };
            searchPageInput.onblur = function() {
                let val = parseInt(this.value, 10);
                if (isNaN(val)) {
                    this.value = lastSearchPageValue;
                    return;
                }
                if (val < 1) val = 1;
                if (val > totalPages) val = totalPages;
                
                searchPage = val;
                renderSearchPage(searchPage);
            };
            searchPageInput.onkeydown = function(e) {
                if (e.key === 'Enter') {
                    this.blur();
                }
            };
        }

        
        let searchDebounce;
        searchInput.addEventListener('input', function() {
            zoomView.style.display = "none";
            clearTimeout(searchDebounce);
            searchDebounce = setTimeout(() => {
                
                document.getElementById('searchResult').innerHTML = '';
            }, 300);
        });

        searchInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                
                e.preventDefault();
                e.stopPropagation();
                const query = this.value.trim().toLowerCase();
                document.getElementById('searchResult').innerHTML = '';
                isSearching = !!query;
                searchResults = [];
                searchPage = 1;
                if (query) {
                    galleryImages.forEach(imgData => {
                        const product = (window.products && window.products[imgData.code]) ? window.products[imgData.code] : {};
                        const infoText = [
                            product.name,
                            product.intro,
                            product.size,
                            product.color,
                            product.price
                        ].filter(Boolean).join(' ').toLowerCase();
                        const queryWords = query.split(/\s+/).filter(Boolean);
                        const codeText = imgData.code.toLowerCase();
                        const allText = codeText + ' ' + infoText;

                        let score = 0;
                        if (allText.includes(queryWords[0])) score += 100;
                        queryWords.forEach(word => {
                            if (allText.includes(word)) score += 1;
                        });
                        if (allText.includes(query)) score += 10; 

                        if (score > 0) {
                            searchResults.push({ ...imgData, _score: score });
                        }
                    });
                    if (searchResults.length === 0) {
                        gallery.innerHTML = '';
                        document.getElementById('searchResult').innerHTML = '';
                        let pagination = document.getElementById('gallery-pagination');
                        if (pagination) pagination.innerHTML = '';
                    } else {
                        searchResults.sort((a, b) => b._score - a._score);
                        renderSearchPage(searchPage);
                    }
                } else {
                    isSearching = false;
                    searchResults = [];
                    searchPage = 1;
                    renderGalleryPage(currentPage);
                    let pagination = document.getElementById('gallery-pagination');
                    if (pagination) pagination.style.display = '';
                }
                
                const isMobile = window.matchMedia('(max-width: 600px) and (hover: none) and (pointer: coarse)').matches;
                if (isMobile) this.blur();
            }
        });

        function showZoomView(code, imgSrc) {
            const product = window.products?.[code];
            zoomView.style.display = "flex";
            zoomView.querySelector('.zoom-img').src = imgSrc;
            zoomView.querySelector('.zoom-img').alt = product?.name || code;
            zoomView.querySelector('.zoom-title').textContent = product?.name || code;
            zoomView.querySelector('.zoom-price').textContent = product?.price || "";
            zoomView.querySelector('.zoom-size-color').innerHTML = `
                <span style="color:#2196f3;">Kích cỡ:</span> ${product?.size || "Đang cập nhật"}
                <br>
                <span style="color:#2196f3;">Màu sắc:</span> ${product?.color || "Đang cập nhật"}
            `;
            zoomView.querySelector('.zoom-intro').textContent = product?.intro || "";
            zoomView.querySelector('.zoom-close').onclick = function() {
                zoomView.style.display = "none";
            };
            setTimeout(() => {
                zoomView.scrollIntoView({ behavior: "auto", block: "center" });
            }, 0);
        }

        
        const menuItems = document.querySelectorAll('.menu a');
        const popup = document.getElementById('dynamic-popup');
        const lienheIcon = document.querySelector('.menu a[href="#lienhe"]');
        const searchIcon = document.querySelector('.menu a[href="#tiemkim"]'); 
        const searchPopup = document.getElementById('search-popup');

        menuItems.forEach((item) => {
            function handler(e) {
                if (item._handled) return;
                item._handled = true;
                setTimeout(() => { item._handled = false; }, 300);

                const isMobile = window.matchMedia('(max-width: 600px) and (hover: none) and (pointer: coarse)').matches;

                if (isMobile) {
                    if (this.classList.contains('active')) {
                        this.classList.remove('active');
                        if (this === lienheIcon) popup.classList.remove('active');
                        if (this === searchIcon) {
                            searchPopup.classList.remove('active');
                            searchInput.value = '';
                            document.getElementById('searchResult').innerHTML = '';
                            if (isSearching) {
                                isSearching = false;
                                searchResults = [];
                                searchPage = 1;
                                renderGalleryPage(currentPage);
                            }
                        }
                    } else {
                        this.classList.add('active');
                        if (this === lienheIcon) {
                            popup.classList.add('active');
                        }
                        if (this === searchIcon) {
                            searchPopup.classList.add('active');
                            searchInput.value = '';
                            document.getElementById('searchResult').innerHTML = '';
                        }
                    }
                    return;
                }

                if (this.classList.contains('active')) {
                    this.classList.remove('active');
                    if (this === lienheIcon) popup.classList.remove('active');
                    if (this === searchIcon) {
                        searchPopup.classList.remove('active');
                        searchInput.value = '';
                        document.getElementById('searchResult').innerHTML = '';
                        if (isSearching) {
                            isSearching = false;
                            searchResults = [];
                            searchPage = 1;
                            renderGalleryPage(currentPage);
                        }
                    }
                    return;
                }
                menuItems.forEach(i => i.classList.remove('active'));
                popup.classList.remove('active');
                searchPopup.classList.remove('active');
                this.classList.add('active');
                if (this === lienheIcon) {
                    popup.classList.add('active');
                }
                if (this === searchIcon) {
                    searchPopup.classList.add('active');
                    searchInput.value = '';
                    document.getElementById('searchResult').innerHTML = '';
                }
            }

            item.addEventListener('touchstart', handler);
            item.addEventListener('click', handler);
        });

        let lastScroll = window.scrollY;
        const menu = document.querySelector('.menu');
        menu.classList.add('show');

        window.addEventListener('scroll', function() {
            let currentScroll = window.scrollY;
            const isMobile = window.matchMedia('(max-width: 600px) and (hover: none) and (pointer: coarse)').matches;
            if (!isMobile) {
                if (
                    searchPopup.classList.contains('active') &&
                    (isSearching && searchResults.length > 0)
                ) {
                    if (currentScroll < lastScroll) {
                        menu.classList.add('show');
                        menu.classList.remove('hide');
                        searchPopup.classList.add('active');
                    } else if (currentScroll > lastScroll) {
                        menu.classList.add('hide');
                        menu.classList.remove('show');
                        searchPopup.classList.remove('active');
                    }
                    lastScroll = currentScroll;
                    return;
                }
                if (
                    searchPopup.classList.contains('active') &&
                    searchInput.value.trim() !== ''
                ) {
                    menu.classList.add('show');
                    menu.classList.remove('hide');
                    return;
                }
                if (currentScroll < lastScroll) {
                    menu.classList.add('show');
                    menu.classList.remove('hide');
                    if (lienheIcon.classList.contains('active')) {
                        popup.classList.add('active');
                    }
                    if (searchPopup && document.querySelector('.menu a[href="#tiemkim"]').classList.contains('active')) {
                        searchPopup.classList.add('active');
                    }
                } else if (currentScroll > lastScroll) {
                    menu.classList.add('hide');
                    menu.classList.remove('show');
                    popup.classList.remove('active');
                    if (searchPopup) {
                        searchPopup.classList.remove('active');
                        searchInput.value = '';
                        document.getElementById('searchResult').innerHTML = '';
                    }
                }
                lastScroll = currentScroll;
            } else {
                menu.classList.add('show');
                menu.classList.remove('hide');
                lastScroll = currentScroll;
            }
        });

        window.addEventListener('resize', () => {
            const newPageSize = window.innerWidth <= 600 ? 10 : 15;
            if (PAGE_SIZE !== newPageSize) {
                PAGE_SIZE = newPageSize;
                if (isSearching && searchResults.length > 0) {
                    renderSearchPage(1);
                } else {
                    renderGalleryPage(1);
                }
            }
        });

        window.addEventListener('DOMContentLoaded', function() {
            setTimeout(function() {
                document.getElementById('intro-overlay').classList.add('hide');
                setTimeout(function() {
                    document.body.classList.remove('hidden-body');
                }, 10);
            }, 500);
        });

        
        loadGalleryImages(function() {
            renderGalleryPage(currentPage);
                
                setTimeout(function() {
                    var modal = document.getElementById('modal-huongdan');
                    if (modal) modal.style.display = 'flex';
                }, 400);
        });
            
            document.addEventListener('DOMContentLoaded', function() {
                var btn = document.getElementById('close-huongdan');
                if (btn) btn.onclick = function() {
                    var modal = document.getElementById('modal-huongdan');
                    if (modal) modal.style.display = 'none';
                };
            });
    </script>
</body>

</html>